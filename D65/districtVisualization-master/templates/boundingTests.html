<!DOCTYPE html>

<!-- Notes


This page represents the comparison between various results files that came from
Felix Peng's bounding tests. Essentially we wished to derive results that represent the extremes/boundaries of
what results can be obtained from the optimization model. Felix did this with three methodologies:

Single: Single objective optimization; set a weight of 1 for one objective, 0 for the rest

Solution: Non-normalized optimization, using M = 10,000 to prioritize one objective at a time and 1 for the rest

Norm: Normalized objective function results; prioritizing one objective with M of 10,000 and weighing others
	  with 1, dividing each by the objective value from corresponding single-obj optimization

Since there are five objectives, five different result files were obtained for each method, which results in
15 unique result files. The writeToJSON python script was modified to write in the relevant characteristics from
each result file into the blocks.

This page compares all of the possible pairs with regards to different objectives and demographics:
bused for distance, race, etc

For the demographics it compares the population density of blocks that were reassigned in one result file, to another
result file's demographics.

This page is abstracted to work with each method, so that if the
user wants to see the comparison between the norm result files, then
they can do that, but they can also compare the singles files and solutions files

=====================================================
=====================================================
The slider modification is not too complicated. It works by setting the scale for the different values
the slider has. Right now it increments by four. In any of the modify_____  functions, you'll notice
that the structure is this:

if percent === 0
    do something
if 8.3 * percentages[percent] === 830
    do something
else
    do something

By the way, the triple = is a special JavaScript boolean operator. I think it's more strict on data type comparisons,
but I'm not sure. I used it to avoid syntax errors.

Back to the slider modification explanation:

With the structure above it basically tests to see if the slider dial/cursor/indicator/some official name, is at the left or
right side.

percentages is an array with values from 0 to 100 in increments of four, or 4 times the possible values for the slider
(0 to 25). This enables us to manipulate all blocks because there are currently 830, and 8.3 * percentages[25] is equal
to 8.3 times 100 or 830

Essentially, if percent is zero then the slider is all the way on the left, so then the map should reflect completely
one solution, let's call it A. If the slider is all the way on the right or 8.3 * percentages[25] === 830, then the
map should reflect completely solution B. In the case that the slider is in between the right and left sides, then
this should mean that the map reflects part of A and part of B. This is done by coloring blocks 1 to
8.3 * percentages[percent] according to solution A, and (8.3 * percentages[percent]) + 1 to 830 according to solution B.
Say that the slider moved up to 1, then percentages[1] is 4, so 8.3 * 4 is roughly 32, so then approximately
blocks 1 to 32 will be colored according to solution A, and blocks 33 to 830 according to solution B.




//School district boundaries/Numbering System
// 0 - Dawes
// 1 - Dewey
// 2 - Kingsley
// 3 - Lincoln
// 4 - Lincolnwood
// 5 - Oakton
// 6 - Orrington
// 7 - Walker
// 8 - Washington
// 9 - Willard
// 10 - Bessie Rhodes
// 11 - MLK

Most buttons can be added to the map using this skeleton:

   <div class='map-overlay-button (put specific button name here)'>
    	<div class='map-overlay-inner-button'>
        	<fieldset>
            	<label>(put actual button name here, the name the user will see)</label>
            	<button id=" (put a name for the button here, a short one that you can refer to in the file)"></button>
        	</fieldset>
    	</div>
   </div>

=====================================================
=====================================================
To change the color of the blocks via mapbox style function calls, use this command:

 map.setPaintProperty("blocks", 'fill-color', (put values here));  Here is an example:

 map.setPaintProperty("blocks", 'fill-color', ["case",
         ["==", ["number", ['get', 'busedHazard']],
             300], "transparent",//not in district
         ["==", ["number", ['get', 'busedDistance']],
             0], "#fef0d9", //light white
         ["<", ["number", ['get', 'busedDistance']],
             1], "#fdcc8a",
         ["<", ["number", ['get', 'busedDistance']],
             2], "#fc8d59",
         ["<", ["number", ['get', 'busedDistance']],
             3], "#e34a33", //orange
         /* > 3 */  "#b30000"]);//dark red

Notice that a color appears in this kind of format: a string with numbers and letters, like  "#fef0d9"

Notice that the color values differ for different boolean cases. Go to this link to learn how to write
these special mapbox expressions which look like Racket code from CS 111: https://docs.mapbox.com/mapbox-gl-js/style-spec/


=====================================================
=====================================================
JavaScript function syntax:

function function_name( put parameters/arguments/inputs here)
{
  put function body code here, JS functions DO NOT NEED return statements

}



=====================================================
=====================================================
Clearing and filling the dynamic legend (the transparent
box that has color blocks with descriptions
for each block)

--- This while loop clears the "data" currently inside of the
legend

while (legend.hasChildNodes()) {
         legend.removeChild(legend.firstChild);
     }

--- Replace the strings inside of the layers array with the various descriptions you want for the legend
and replace the colors array with the corresponding colors for the descriptions

     var layers = ['Zero students', 'One Student', 'Two Students', 'Three Students', 'Greater than Three Students'];
     var colors = ["#fef0d9", "#fdcc8a", "#fc8d59", "#e34a33", "#b30000"];

--- This for loop adds each color and layer to the legend by creating HTML elements on the go

     for (i = 0; i < layers.length; i++) {
         var layer = layers[i];
         var color = colors[i];
         var item = document.createElement('div');
         var key = document.createElement('span');
         key.className = 'legend-key';
         key.style.backgroundColor = color;

         var value = document.createElement('span');
         value.innerHTML = layer;
         item.appendChild(key);
         item.appendChild(value);
         legend.appendChild(item);
     }


=====================================================
=====================================================
Most hovering drop down lists/menus can be added using
this skeleton (each menu needs its own set of classes. Look at the css
 file for any of the pages that has a dropdown menu to see an example of how to do this correctly.
 It is really just copy and paste):

    <div class="dropdown">
      <button class="dropbtn"> (put menu title here) </button>
      <div class="dropdown-content">
       --You can use the <a> tag for calling JS functions or hyperlinks: <a onclick=" (function name here) ">(button title here)</a>
        <a onclick=" (function name here) ">(button title here)</a>
        <a onclick=" (function name here) ">(button title here)</a>
          and so on...
      </div>
    </div>

-->
<html>
<head>
    <meta charset='utf-8' />
    <title>D65</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.46.0/mapbox-gl.js'></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <!-- <script src="../static/mapVisual.js"></script> -->
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.46.0/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" type="text/css" href="../static/boundingTests.css">
    <!-- CSS information for the map -->
    <style>
      body { margin:0; padding:0; }
      #map { position:absolute; top:40px; bottom:0; width:100%; }
    </style>
</head>
<body>

<!-- HTML -->

<div id='nav_bar'></div>
<div id="map"></div>
<div class='map-overlay-legend All' id='legend'> </div>


        <div class='map-overlay slider'>
            <div class='map-overlay-inner'>
                <h2>Bounding Tests Comparison</h2>
                    <label id='month'></label>
                        <input id='slider' type='range' min='0' max='25' step='1' value='0' />
                </div>
        </div>




    <!--Various dropdown menus-->
    <div class="dropdown">
      <button class="dropbtn">Navigate</button>
      <div class="dropdown-content">
        <a href="http://127.0.0.1:5000/">Home Page</a>
        <a onclick="pageDescription()">Page Description</a>

      </div>
    </div>

    <div class="dropdown1">
          <button class="dropbtn1">Assignment</button>
          <div class="dropdown1-content">
            <a onclick="compAssignment('1', '2')">2 v. 1</a>
            <a onclick="compAssignment('1', '3')">3 v. 1</a>
            <a onclick="compAssignment('1', '4')">4 v. 1</a>
            <a onclick="compAssignment('1', '5')">5 v. 1</a>
            <a onclick="compAssignment('2', '3')">3 v. 2</a>
            <a onclick="compAssignment('2', '4')">4 v. 2</a>
            <a onclick="compAssignment('2', '5')">5 v. 2</a>
            <a onclick="compAssignment('3', '4')">4 v. 3</a>
            <a onclick="compAssignment('3', '5')">5 v. 3</a>
            <a onclick="compAssignment('4', '5')">5 v. 4</a>
          </div>
        </div>

    <div class="dropdown2">
          <button class="dropbtn2">Hazards</button>
          <div class="dropdown2-content">
            <a onclick="compHazard_or_Distance('1', '2', 'Hazard')">2 v. 1</a>
            <a onclick="compHazard_or_Distance('1', '3', 'Hazard')">3 v. 1</a>
            <a onclick="compHazard_or_Distance('1', '4', 'Hazard')">4 v. 1</a>
            <a onclick="compHazard_or_Distance('1', '5', 'Hazard')">5 v. 1</a>
            <a onclick="compHazard_or_Distance('2', '3', 'Hazard')">3 v. 2</a>
            <a onclick="compHazard_or_Distance('2', '4', 'Hazard')">4 v. 2</a>
            <a onclick="compHazard_or_Distance('2', '5', 'Hazard')">5 v. 2</a>
            <a onclick="compHazard_or_Distance('3', '4', 'Hazard')">4 v. 3</a>
            <a onclick="compHazard_or_Distance('3', '5', 'Hazard')">5 v. 3</a>
            <a onclick="compHazard_or_Distance('4', '5', 'Hazard')">5 v. 4</a>
          </div>
        </div>

    <div class="dropdown3">
              <button class="dropbtn3">Distance</button>
              <div class="dropdown3-content">
            <a onclick="compHazard_or_Distance('1', '2', 'Distance')">2 v. 1</a>
            <a onclick="compHazard_or_Distance('1', '3', 'Distance')">3 v. 1</a>
            <a onclick="compHazard_or_Distance('1', '4', 'Distance')">4 v. 1</a>
            <a onclick="compHazard_or_Distance('1', '5', 'Distance')">5 v. 1</a>
            <a onclick="compHazard_or_Distance('2', '3', 'Distance')">3 v. 2</a>
            <a onclick="compHazard_or_Distance('2', '4', 'Distance')">4 v. 2</a>
            <a onclick="compHazard_or_Distance('2', '5', 'Distance')">5 v. 2</a>
            <a onclick="compHazard_or_Distance('3', '4', 'Distance')">4 v. 3</a>
            <a onclick="compHazard_or_Distance('3', '5', 'Distance')">5 v. 3</a>
            <a onclick="compHazard_or_Distance('4', '5', 'Distance')">5 v. 4</a>
              </div>
            </div>

    <div class="dropdown7">
      <button class="dropbtn7">Legend Toggles</button>
      <div class="dropdown7-content">
        <a onclick="legendToggle()">Show/Hide Color Legend</a>
      </div>
    </div>

    <div class="dropdown5">
        <button class="dropbtn5">Race</button>
        <div class="dropdown5-content">
            <a onclick="compRace('1', '2')">2 v. 1</a>
            <a onclick="compRace('1', '3')">3 v. 1</a>
            <a onclick="compRace('1', '4')">4 v. 1</a>
            <a onclick="compRace('1', '5')">5 v. 1</a>
            <a onclick="compRace('2', '3')">3 v. 2</a>
            <a onclick="compRace('2', '4')">4 v. 2</a>
            <a onclick="compRace('2', '5')">5 v. 2</a>
            <a onclick="compRace('3', '4')">4 v. 3</a>
            <a onclick="compRace('3', '5')">5 v. 3</a>
            <a onclick="compRace('4', '5')">5 v. 4</a>
        </div>
    </div>

    <div class="dropdown6">
        <button class="dropbtn6">Grades</button>
        <div class="dropdown6-content">
            <a onclick="compGrades('1', '2')">2 v. 1</a>
            <a onclick="compGrades('1', '3')">3 v. 1</a>
            <a onclick="compGrades('1', '4')">4 v. 1</a>
            <a onclick="compGrades('1', '5')">5 v. 1</a>
            <a onclick="compGrades('2', '3')">3 v. 2</a>
            <a onclick="compGrades('2', '4')">4 v. 2</a>
            <a onclick="compGrades('2', '5')">5 v. 2</a>
            <a onclick="compGrades('3', '4')">4 v. 3</a>
            <a onclick="compGrades('3', '5')">5 v. 3</a>
            <a onclick="compGrades('4', '5')">5 v. 4</a>
        </div>
    </div>

     <div class="dropdown4">
        <button class="dropbtn4">TWI</button>
        <div class="dropdown4-content">
            <a onclick="compTWI('1', '2')">2 v. 1</a>
            <a onclick="compTWI('1', '3')">3 v. 1</a>
            <a onclick="compTWI('1', '4')">4 v. 1</a>
            <a onclick="compTWI('1', '5')">5 v. 1</a>
            <a onclick="compTWI('2', '3')">3 v. 2</a>
            <a onclick="compTWI('2', '4')">4 v. 2</a>
            <a onclick="compTWI('2', '5')">5 v. 2</a>
            <a onclick="compTWI('3', '4')">4 v. 3</a>
            <a onclick="compTWI('3', '5')">5 v. 3</a>
            <a onclick="compTWI('4', '5')">5 v. 4</a>
        </div>
    </div>

</body>
</html>


<script type="text/javascript">

///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
// Displaying the map

mapboxgl.accessToken = 'pk.eyJ1IjoiZXJpbmJydW5zIiwiYSI6ImNqajV3MG51bjI0MWkzcG1tZXZycjdyZWcifQ.-X9WJp4KZ6VEGrkDQI3A_w';
var map = new mapboxgl.Map(
{
container: 'map', // container id
style: 'mapbox://styles/mapbox/light-v9', // stylesheet location
center: [-87.6877, 42.0451], // starting position [lng, lat]
zoom: 12.7// starting zoom
});

// Storing the passed in methodName
// from the render_template function call
// in a variable for repeated use throughout
// this file
var methodName = '{{ methodName }}';

var blocks = { "type": "geojson",
               "data": "./static/blocks.geojson"};

var blockLabels = { "type": "geojson",
                            "data": "./static/blockLabels.geojson"};

var schools = { "type": "geojson",
                            "data": "./static/schools.geojson"};

map.on('load', function() {
    map.addSource("blockLabels", blockLabels);
    map.addSource("blocks", blocks);
    map.addSource("schools", schools);


    // //adds labels to map
   /* map.addLayer({"id": "blockLabels",
                 "type": "symbol",
                 "source": "blockLabels",
                 "layout": { "icon-image": "{icon}-11",
                             "icon-allow-overlap": true,
                             "text-field": "{title}",
                             "text-font": ["Open Sans Regular", "Arial Unicode MS Regular"],
                             "text-offset": [0, 0.6],
                             "text-anchor": "top"}
    });
    */
    //adds schools to map
    map.addLayer({"id": "schools",
                "type": "symbol",
                "source": "schools",
                "layout": { "icon-image": "{icon}-11",
                            "icon-allow-overlap": true,
                            "text-field": "{title}",
                            "text-font": ["Open Sans Regular", "Arial Unicode MS Regular"],
                            "text-offset": [0, 0.6],
                            "text-anchor": "top"}
    });

    //adds blocks to map
    map.addLayer({
        "id": "blocks",
        "type": "fill",
        "source": "blocks",
        "layout": {},
        "paint": {
             "fill-color": "#86F",
             "fill-opacity": 0.7

        }
    });


assignmentVisual('current');
});




legendOn();



//Function for the page description
function pageDescription()
{
    window.confirm('This page represents the comparison between various results files for the' +
        ' bounding tests. We derived results that represent the extremes/boundaries of\n' +
        'what results can be obtained from the optimization model, with three methodologies:\n' +
        '\n' +
        'Single: Single objective optimization; weight of 1 for one objective, 0 for the rest\n' +
        '\n' +
        'Solution: Non-normalized optimization, M = 10,000 to prioritize one objective at a time and 1 for the rest\n' +
        '\n' +
        'Norm: Normalized objective function results; one objective with M of 10,000 and weighing others\n' +
        '\t  with 1, dividing each by the objective value from corresponding single-obj optimization\n' +
        '\n' +
        'Five different result files were obtained for each method, which results in\n' +
        '15 unique result files. This page compares all of the possible pairs with ' +
        'regards to different objectives and demographics: bused for distance, race, etc\n' +
        'For the demographics it compares the population density of blocks that were reassigned in one result file, to another \n' +
        'result file\'s demographics.\n This page is for the ' + methodName + ' method.');
}



///////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
// Functions for the legend, to hide or display it, by altering its display style
function legendOn()
{
    var legendObj = document.getElementById('legend');
    legendObj.style.display = "block";
}
function legendOff()
{
    var legendObj = document.getElementById('legend');
    legendObj.style.display = "none";
}

function  legendToggle()
{
    var legendObj = document.getElementById('legend');
    if (legendObj.style.display === "none")
        legendObj.style.display = "block";
    else
        legendObj.style.display = "none";
}


//Kind-of-sort-of creating an event listener for the optimization model input box
$('#optimizationButton').on('click', function(){

            var blocksAssigned = $('#blocksAssigned').val();
            var travelDistance = $('#travelDistance').val();
            var excessStudents = $('#excessStudents').val();
            var studentsBussed = $('#studentsBussed').val();
            var yearlyBusPerSchool = $('#yearlyBusPerSchool').val();
            var titleOneEligibleSchools = $('#titleOneEligibleSchools').val();

            //var contiguity = $('contiguity').val();
            // if($('#contiguity').prop("checked") == true)
            // {
            //   console.log("is checked")
            //   contiguity = 1;
            // }
            //e.preventDefault();
            console.log("clicked");

            if ( $('input[name="contiguity"]').is(':checked') ) {
                var contiguity = 1;
            }
            else{
                var contiguity = 0;
            }
             $.ajax({
                url: 'http://127.0.0.1:5000/square/',
                data: {'blocksAssigned': blocksAssigned,
                       'travelDistance': travelDistance,
                       'excessStudents': excessStudents,
                       'studentsBussed': studentsBussed,
                       'yearlyBusPerSchool': yearlyBusPerSchool,
                       'titleOneEligibleSchools': titleOneEligibleSchools,
                       'contiguity': contiguity},
                method: 'POST',
                success: function() {
                    $('#blocksAssigned').val('');
                    $('#travelDistance').val('');
                    $('#excessStudents').val('');
                    $('#studentsBussed').val('');
                    $('#yearlyBusPerSchool').val('');
                    $('#titleOneEligibleSchools').val('');
                    $('#myCheckbox').prop('checked', false);
                    console.log("success");
                }
            });
        });






var percentages = [];

for (i = 0; i <= 100; i = i + 4)
{
    percentages.push(i);
}


//Slider modification by assignment
function compAssignment(resultA, resultB) {
    document.getElementById('slider').addEventListener('input', function(input)
    {
        var percent = parseInt(input.target.value, 10);
        modifyAssignment(percent, resultA, resultB);
    });
}



function modifyAssignment(percent, resultA, resultB) {
    console.log(percent);
    console.log(percentages[percent]);
    if (percent == 0)
    {
        map.setPaintProperty("blocks", 'fill-color',
         ["match", ["number", ['get', 'newSchool_' + methodName + resultA]],
                     0, "#228B22", //dark green
                     1, "#7FFF00", //light green
                     2, "#FFFF00", //yellow
                     3, "#FFA500", //orange
                     4, "#4410bc",
                     5, "#6BE144",
                     6, "#d1503c",
                     7, "#DA3CDC",
                     8, "#ABABAB",
                     9, "#19E2D1",
                     10, "#111111",
                     11, "#987234",
                     12, "#ABCDE1",
                     300, "transparent",
                     "transparent"]);
    } // This checks if the slider is all the way at the right end, in which case the map completely
      // switches to map B
    if (8.3 * percentages[percent] == 830) {
       map.setPaintProperty("blocks", 'fill-color',
         ["match", ["number", ['get', 'newSchool_' + methodName + resultB]],
                     0, "#228B22", //dark green
                     1, "#7FFF00", //light green
                     2, "#FFFF00", //yellow
                     3, "#FFA500", //orange
                     4, "#4410bc",
                     5, "#6BE144",
                     6, "#d1503c",
                     7, "#DA3CDC",
                     8, "#ABABAB",
                     9, "#19E2D1",
                     10, "#111111",
                     11, "#987234",
                     12, "#ABCDE1",
                     300, "transparent",
                     "transparent"]);
    }
    else {
        map.setPaintProperty('blocks', 'fill-color', ['case',
            ['all', ['>=', ['number', ['get', 'id']],
                1],
                ['<=', ['number', ['get', 'id']],
                    8.3 * percentages[percent]],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultA]],
                    0]],
            "#228B22",
            ['all', ['>=', ['number', ['get', 'id']],
                1],
                ['<=', ['number', ['get', 'id']],
                    8.3 * percentages[percent]],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultA]],
                    1]],
            "#7FFF00",
            ['all', ['>=', ['number', ['get', 'id']],
                1],
                ['<=', ['number', ['get', 'id']],
                    8.3 * percentages[percent]],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultA]],
                    2]],
            "#FFFF00",
            ['all', ['>=', ['number', ['get', 'id']],
                1],
                ['<=', ['number', ['get', 'id']],
                    8.3 * percentages[percent]],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultA]],
                    3]],
            "#FFA500",
            ['all', ['>=', ['number', ['get', 'id']],
                1],
                ['<=', ['number', ['get', 'id']],
                    8.3 * percentages[percent]],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultA]],
                    4]],
            "#4410bc",
            ['all', ['>=', ['number', ['get', 'id']],
                1],
                ['<=', ['number', ['get', 'id']],
                    8.3 * percentages[percent]],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultA]],
                    5]],
            "#6BE144",
            ['all', ['>=', ['number', ['get', 'id']],
                1],
                ['<=', ['number', ['get', 'id']],
                    8.3 * percentages[percent]],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultA]],
                    6]],
            "#d1503c",
            ['all', ['>=', ['number', ['get', 'id']],
                1],
                ['<=', ['number', ['get', 'id']],
                    8.3 * percentages[percent]],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultA]],
                    7]],
            "#DA3CDC",
            ['all', ['>=', ['number', ['get', 'id']],
                1],
                ['<=', ['number', ['get', 'id']],
                    8.3 * percentages[percent]],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultA]],
                    8]],
            "#ABABAB",
            ['all', ['>=', ['number', ['get', 'id']],
                1],
                ['<=', ['number', ['get', 'id']],
                    8.3 * percentages[percent]],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultA]],
                    9]],
            "#19E2D1",
            ['all', ['>=', ['number', ['get', 'id']],
                1],
                ['<=', ['number', ['get', 'id']],
                    8.3 * percentages[percent]],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultA]],
                    10]],
            "#111111",
            ['all', ['>=', ['number', ['get', 'id']],
                1],
                ['<=', ['number', ['get', 'id']],
                    8.3 * percentages[percent]],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultA]],
                    11]],
            "#987234",
            ['all', ['>=', ['number', ['get', 'id']],
                1],
                ['<=', ['number', ['get', 'id']],
                    8.3 * percentages[percent]],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultA]],
                    12]],
            "#ABCDE1",
            ['all', ['>=', ['number', ['get', 'id']],
                (8.3 * percentages[percent]) + 1],
                ['<=', ['number', ['get', 'id']],
                    830],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultB]],
                    0]],
            "#228B22",
            ['all', ['>=', ['number', ['get', 'id']],
                (8.3 * percentages[percent]) + 1],
                ['<=', ['number', ['get', 'id']],
                    830],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultB]],
                    1]],
            "#7FFF00",
            ['all', ['>=', ['number', ['get', 'id']],
                (8.3 * percentages[percent]) + 1],
                ['<=', ['number', ['get', 'id']],
                    830],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultB]],
                    2]],
            "#FFFF00",
            ['all', ['>=', ['number', ['get', 'id']],
                (8.3 * percentages[percent]) + 1],
                ['<=', ['number', ['get', 'id']],
                    830],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultB]],
                    3]],
            "#FFA500",
            ['all', ['>=', ['number', ['get', 'id']],
                (8.3 * percentages[percent]) + 1],
                ['<=', ['number', ['get', 'id']],
                    830],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultB]],
                    4]],
            "#4410bc",
            ['all', ['>=', ['number', ['get', 'id']],
                (8.3 * percentages[percent]) + 1],
                ['<=', ['number', ['get', 'id']],
                    830],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultB]],
                    5]],
            "#6BE144",
            ['all', ['>=', ['number', ['get', 'id']],
                (8.3 * percentages[percent]) + 1],
                ['<=', ['number', ['get', 'id']],
                    830],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultB]],
                    6]],
            "#d1503c",
            ['all', ['>=', ['number', ['get', 'id']],
                (8.3 * percentages[percent]) + 1],
                ['<=', ['number', ['get', 'id']],
                    830],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultB]],
                    7]],
            "#DA3CDC",
            ['all', ['>=', ['number', ['get', 'id']],
                (8.3 * percentages[percent]) + 1],
                ['<=', ['number', ['get', 'id']],
                    830],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultB]],
                    8]],
            "#ABABAB",
            ['all', ['>=', ['number', ['get', 'id']],
                (8.3 * percentages[percent]) + 1],
                ['<=', ['number', ['get', 'id']],
                    830],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultB]],
                    9]],
            "#19E2D1",
            ['all', ['>=', ['number', ['get', 'id']],
                (8.3 * percentages[percent]) + 1],
                ['<=', ['number', ['get', 'id']],
                    830],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultB]],
                    10]],
            "#111111",
            ['all', ['>=', ['number', ['get', 'id']],
                (8.3 * percentages[percent]) + 1],
                ['<=', ['number', ['get', 'id']],
                    830],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultB]],
                    11]],
            "#987234",
            ['all', ['>=', ['number', ['get', 'id']],
                (8.3 * percentages[percent]) + 1],
                ['<=', ['number', ['get', 'id']],
                    830],
                ['==', ['number', ['get', 'newSchool_' + methodName + resultB]],
                    12]],
            "#ABCDE1",
            "transparent"
        ]);
    }
    // Set the label to the month
    document.getElementById('month').textContent = percentages[percent];

    while (legend.hasChildNodes()) {
     legend.removeChild(legend.firstChild);
 }

 var layers = ['Dawes', 'Dewey', 'Kingsley', 'Lincoln', 'Lincolnwood', 'Oakton',
               'Orrington', 'Walker', 'Washington', 'Willard', 'Bessie Rhodes', 'MLK'];
 var colors = ["#228B22", //dark green
               "#7FFF00", //light green
               "#FFFF00", //yellow
               "#FFA500", //orange
               "#4410bc",
               "#6BE144",
               "#d1503c",
               "#DA3CDC",
               "#ABABAB",
               "#19E2D1",
               "#111111",
               "#987234",
               "#ABCDE1",];

var label = document.createElement('label');
label.innerHTML = resultB + ' v. ' + resultA;
legend.appendChild(label);

 for (i = 0; i < layers.length; i++) {
     var layer = layers[i];
     var color = colors[i];
     var item = document.createElement('div');
     var key = document.createElement('span');
     key.className = 'legend-key';
     key.style.backgroundColor = color;

     var value = document.createElement('span');
     value.innerHTML = layer;
     item.appendChild(key);
     item.appendChild(value);
     legend.appendChild(item);
 }
}


///////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////
//Slider modification by bussed for hazards and distance
function compHazard_or_Distance(resultA, resultB, busType) {
    document.getElementById('slider').addEventListener('input', function(input)
    {
        var percent = parseInt(input.target.value, 10);
        modifyHazard_or_Distance(percent, resultA, resultB, busType);
    });
}

function modifyHazard_or_Distance(percent, resultA, resultB, busType)
{

    if (percent == 0)
    {
        map.setPaintProperty("blocks", 'fill-color', ["case",
        ["==", ["number", ['get', 'bused' + busType + '_' + methodName + resultA]],
            300], "transparent",//not in district
        ["==", ["number", ['get', 'bused' + busType + '_' + methodName + resultA]],
            0], "#fef0d9", //light white
        ["<", ["number", ['get', 'bused' + busType + '_' + methodName + resultA]],
            1], "#fdcc8a",
        ["<", ["number", ['get', 'bused' + busType + '_' + methodName + resultA]],
            2], "#fc8d59",
        ["<", ["number", ['get', 'bused' + busType + '_' + methodName + resultA]],
            3], "#e34a33", //orange
        /* > 3 */  "#b30000"]);//dark red
    }
    if (8.3 * percentages[percent] == 830)
    {
        map.setPaintProperty("blocks", 'fill-color', ["case",
        ["==", ["number", ['get', 'bused' + busType + '_' + methodName + resultB]],
            300], "transparent",//not in district
        ["==", ["number", ['get', 'bused' + busType + '_' + methodName + resultB]],
            0], "#fef0d9", //light white
        ["<", ["number", ['get', 'bused' + busType + '_' + methodName + resultB]],
            1], "#fdcc8a",
        ["<", ["number", ['get', 'bused' + busType + '_' + methodName + resultB]],
            2], "#fc8d59",
        ["<", ["number", ['get', 'bused' + busType + '_' + methodName + resultB]],
            3], "#e34a33", //orange
        /* > 3 */  "#b30000"]);//dark red
    }
    else
    {
        map.setPaintProperty("blocks", 'fill-color', ["case",
        ['all', ['>=', ['number', ['get', 'id']],
                1],
                ['<=', ['number', ['get', 'id']],
                    8.3 * percentages[percent]],
                ["==", ["number", ['get', 'bused' + busType + '_' + methodName + resultA]],
                        300]], "transparent",//not in district
        ['all', ['>=', ['number', ['get', 'id']],
                1],
                ['<=', ['number', ['get', 'id']],
                    8.3 * percentages[percent]],
                ["==", ["number", ['get', 'bused' + busType + '_' + methodName + resultA]],
                        0]], "#fef0d9", //light white
        ['all', ['>=', ['number', ['get', 'id']],
                1],
                ['<=', ['number', ['get', 'id']],
                    8.3 * percentages[percent]],
                ["<", ["number", ['get', 'bused' + busType + '_' + methodName + resultA]],
                        1]], "#fdcc8a",
        ['all', ['>=', ['number', ['get', 'id']],
                1],
                ['<=', ['number', ['get', 'id']],
                    8.3 * percentages[percent]],
                ["<", ["number", ['get', 'bused' + busType + '_' + methodName + resultA]],
                        2]], "#fc8d59",
        ['all', ['>=', ['number', ['get', 'id']],
                1],
                ['<=', ['number', ['get', 'id']],
                    8.3 * percentages[percent]],
                ["<", ["number", ['get', 'bused' + busType + '_' + methodName + resultA]],
                        3]], "#e34a33", //orange
       ['all', ['>=', ['number', ['get', 'id']],
                1],
                ['<=', ['number', ['get', 'id']],
                    8.3 * percentages[percent]],
                [">=", ["number", ['get', 'bused' + busType + '_' + methodName + resultA]],
                        3]], "#b30000",
////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////
        ['all', ['>=', ['number', ['get', 'id']],
                (8.3 * percentages[percent]) + 1],
                ['<=', ['number', ['get', 'id']],
                    830],
                ["==", ["number", ['get', 'bused' + busType + '_' + methodName + resultB]],
                        300]], "transparent",
        ['all', ['>=', ['number', ['get', 'id']],
                (8.3 * percentages[percent]) + 1],
                ['<=', ['number', ['get', 'id']],
                    830],
                ["==", ["number", ['get', 'bused' + busType + '_' + methodName + resultB]],
                        0]], "#fef0d9",
        ['all', ['>=', ['number', ['get', 'id']],
                (8.3 * percentages[percent]) + 1],
                ['<=', ['number', ['get', 'id']],
                    830],
                ["<", ["number", ['get', 'bused' + busType + '_' + methodName + resultB]],
                        1]], "#fdcc8a",
        ['all', ['>=', ['number', ['get', 'id']],
                (8.3 * percentages[percent]) + 1],
                ['<=', ['number', ['get', 'id']],
                    830],
                ["<", ["number", ['get', 'bused' + busType + '_' + methodName + resultB]],
                        2]], "#fc8d59",
        ['all', ['>=', ['number', ['get', 'id']],
                (8.3 * percentages[percent]) + 1],
                ['<=', ['number', ['get', 'id']],
                    830],
                ["<", ["number", ['get', 'bused' + busType + '_' + methodName + resultB]],
                        3]], "#e34a33",
        ['all', ['>=', ['number', ['get', 'id']],
                (8.3 * percentages[percent]) + 1],
                ['<=', ['number', ['get', 'id']],
                    830],
                [">=", ["number", ['get', 'bused' + busType + '_' + methodName + resultB]],
                        3]], "#b30000",
        "transparent"]);
    }





     while (legend.hasChildNodes()) {
        legend.removeChild(legend.firstChild);
    }

    var layers = ['Zero students', 'One Student', 'Two Students', 'Three Students', 'Greater than Three Students'];
    var colors = ["#fef0d9", "#fdcc8a", "#fc8d59", "#e34a33", "#b30000"];

    var label = document.createElement('label');
    label.innerHTML = busType + ': ' + resultB + ' v. ' + resultA;
    legend.appendChild(label);

    for (i = 0; i < layers.length; i++) {
        var layer = layers[i];
        var color = colors[i];
        var item = document.createElement('div');
        var key = document.createElement('span');
        key.className = 'legend-key';
        key.style.backgroundColor = color;

        var value = document.createElement('span');
        value.innerHTML = layer;
        item.appendChild(key);
        item.appendChild(value);
        legend.appendChild(item);
    }
}

//Slider modification by race/ethnic groups
function compRace(resultA, resultB) {
    document.getElementById('slider').addEventListener('input', function(input)
    {
        var percent = parseInt(input.target.value, 10);
        modifyRace(percent, resultA, resultB);
    });
}

function modifyRace(percent, resultA, resultB)
{
    if (percent === 0)
    {
        map.setPaintProperty("blocks", 'fill-color', ["case",
        ["==", ['number', ['get', 'currentSchool']],
                300],
        "transparent",
        ["all",  [">=", ["/", ["number", ['get', 'AfroAmericanNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ['number', ['get', 'currentSchool']],
                        ["number", ['get', 'newSchool_' + methodName + resultA]]]],
        "#43fc0d",
        ["all",  [">=", ["/", ["number", ['get', 'CaucasianNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ['number', ['get', 'currentSchool']],
                        ["number", ['get', 'newSchool_' + methodName  + resultA]]]],
        "#0cebfc",
        ["all",  [">=", ["/", ["number", ['get', 'HispanicNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ['number', ['get', 'currentSchool']],
                        ["number", ['get', 'newSchool_' + methodName  + resultA]]]],
        "#ca0dfc",
        ["all",  [">=", ["/", ["number", ['get', 'OtherRaceNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ['number', ['get', 'currentSchool']],
                        ["number", ['get', 'newSchool_' + methodName  + resultA]]]],
        "#fc092e",
        ["all",  [">=", ["/", ["number", ['get', 'MultiRacialNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ['number', ['get', 'currentSchool']],
                        ["number", ['get', 'newSchool_' + methodName  + resultA]]]],
        "#f37600",
        ["all", ["!=", ['number', ['get', 'currentSchool']],
                        ["number", ['get', 'newSchool_' + methodName  + resultA]]],
                ["!=", ["/", ["number", ['get', 'AfroAmericanNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                ["!=", ["/", ["number", ['get', 'CaucasianNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ["/", ["number", ['get', 'HispanicNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ["/", ["number", ['get', 'OtherRaceNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ["/", ["number", ['get', 'MultiRacialNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5]],
        "#7f7f7f",
        "rgba(255,243,143,0.98)"
    ]);
    }
    if (8.3 * percentages[percent] === 830){
        map.setPaintProperty("blocks", 'fill-color', ["case",
        ["==", ['number', ['get', 'currentSchool']],
                300],
        "transparent",
        ["all",  [">=", ["/", ["number", ['get', 'AfroAmericanNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ['number', ['get', 'currentSchool']],
                        ["number", ['get', 'newSchool_' + methodName  + resultB]]]],
        "#43fc0d",
        ["all",  [">=", ["/", ["number", ['get', 'CaucasianNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ['number', ['get', 'currentSchool']],
                        ["number", ['get', 'newSchool_' + methodName  + resultB]]]],
        "#0cebfc",
        ["all",  [">=", ["/", ["number", ['get', 'HispanicNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ['number', ['get', 'currentSchool']],
                        ["number", ['get', 'newSchool_' + methodName  + resultB]]]],
        "#ca0dfc",
        ["all",  [">=", ["/", ["number", ['get', 'OtherRaceNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ['number', ['get', 'currentSchool']],
                        ["number", ['get', 'newSchool_' + methodName  + resultB]]]],
        "#fc092e",
        ["all",  [">=", ["/", ["number", ['get', 'MultiRacialNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ['number', ['get', 'currentSchool']],
                        ["number", ['get', 'newSchool_' + methodName  + resultB]]]],
        "#f37600",
        ["all", ["!=", ['number', ['get', 'currentSchool']],
                        ["number", ['get', 'newSchool_' + methodName  + resultB]]],
                ["!=", ["/", ["number", ['get', 'AfroAmericanNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                ["!=", ["/", ["number", ['get', 'CaucasianNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ["/", ["number", ['get', 'HispanicNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ["/", ["number", ['get', 'OtherRaceNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ["/", ["number", ['get', 'MultiRacialNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5]],
        "#7f7f7f",
        "rgba(255,243,143,0.98)"
    ]);
    }
    else {
        map.setPaintProperty("blocks", 'fill-color', ["case",
        ["==", ['number', ['get', 'currentSchool']],
                300],
        "transparent",
        ["all", ['>=', ['number', ['get', 'id']],
                       1],
                ['<=', ['number', ['get', 'id']],
                       8.3 * percentages[percent]],
                [">=", ["/", ["number", ['get', 'AfroAmericanNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ['number', ['get', 'currentSchool']],
                        ["number", ['get', 'newSchool_' + methodName  + resultA]]]],
        "#43fc0d",
        ["all", ['>=', ['number', ['get', 'id']],
                       1],
                ['<=', ['number', ['get', 'id']],
                       8.3 * percentages[percent]],
                [">=", ["/", ["number", ['get', 'CaucasianNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ['number', ['get', 'currentSchool']],
                        ["number", ['get', 'newSchool_' + methodName  + resultA]]]],
        "#0cebfc",
        ["all", ['>=', ['number', ['get', 'id']],
                       1],
                ['<=', ['number', ['get', 'id']],
                       8.3 * percentages[percent]],
                [">=", ["/", ["number", ['get', 'HispanicNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ['number', ['get', 'currentSchool']],
                        ["number", ['get', 'newSchool_' + methodName  + resultA]]]],
        "#ca0dfc",
        ["all", ['>=', ['number', ['get', 'id']],
                       1],
                ['<=', ['number', ['get', 'id']],
                       8.3 * percentages[percent]],
                [">=", ["/", ["number", ['get', 'OtherRaceNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ['number', ['get', 'currentSchool']],
                        ["number", ['get', 'newSchool_' + methodName  + resultA]]]],
        "#fc092e",
        ["all", ['>=', ['number', ['get', 'id']],
                       1],
                ['<=', ['number', ['get', 'id']],
                       8.3 * percentages[percent]],
                [">=", ["/", ["number", ['get', 'MultiRacialNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ['number', ['get', 'currentSchool']],
                        ["number", ['get', 'newSchool_' + methodName  + resultA]]]],
        "#f37600",
        ["all", ['>=', ['number', ['get', 'id']],
                       1],
                ['<=', ['number', ['get', 'id']],
                       8.3 * percentages[percent]],
                ["!=", ['number', ['get', 'currentSchool']],
                        ["number", ['get', 'newSchool_' + methodName  + resultA]]],
                ["!=", ["/", ["number", ['get', 'AfroAmericanNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                ["!=", ["/", ["number", ['get', 'CaucasianNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ["/", ["number", ['get', 'HispanicNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ["/", ["number", ['get', 'OtherRaceNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ["/", ["number", ['get', 'MultiRacialNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5]],
        "#7f7f7f",
        ["all", ['>=', ['number', ['get', 'id']],
                       (8.3 * percentages[percent] + 1)],
                ['<=', ['number', ['get', 'id']],
                       830],
                [">=", ["/", ["number", ['get', 'AfroAmericanNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ['number', ['get', 'currentSchool']],
                        ["number", ['get', 'newSchool_' + methodName  + resultB]]]],
        "#43fc0d",
        ["all", ['>=', ['number', ['get', 'id']],
                       (8.3 * percentages[percent] + 1)],
                ['<=', ['number', ['get', 'id']],
                       830],
                [">=", ["/", ["number", ['get', 'CaucasianNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ['number', ['get', 'currentSchool']],
                        ["number", ['get', 'newSchool_' + methodName  + resultB]]]],
        "#0cebfc",
        ["all", ['>=', ['number', ['get', 'id']],
                       (8.3 * percentages[percent] + 1)],
                ['<=', ['number', ['get', 'id']],
                       830],
                [">=", ["/", ["number", ['get', 'HispanicNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ['number', ['get', 'currentSchool']],
                        ["number", ['get', 'newSchool_' + methodName  + resultB]]]],
        "#ca0dfc",
        ["all", ['>=', ['number', ['get', 'id']],
                       (8.3 * percentages[percent] + 1)],
                ['<=', ['number', ['get', 'id']],
                       830],
                [">=", ["/", ["number", ['get', 'OtherRaceNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ['number', ['get', 'currentSchool']],
                        ["number", ['get', 'newSchool_' + methodName + resultB]]]],
        "#fc092e",
        ["all", ['>=', ['number', ['get', 'id']],
                       (8.3 * percentages[percent] + 1)],
                ['<=', ['number', ['get', 'id']],
                       830],
                [">=", ["/", ["number", ['get', 'MultiRacialNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ['number', ['get', 'currentSchool']],
                        ["number", ['get', 'newSchool_' + methodName + resultB]]]],
        "#f37600",
        ["all", ['>=', ['number', ['get', 'id']],
                       (8.3 * percentages[percent] + 1)],
                ['<=', ['number', ['get', 'id']],
                       830],
                ["!=", ['number', ['get', 'currentSchool']],
                        ["number", ['get', 'newSchool_' + methodName + resultB]]],
                ["!=", ["/", ["number", ['get', 'AfroAmericanNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                ["!=", ["/", ["number", ['get', 'CaucasianNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ["/", ["number", ['get', 'HispanicNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ["/", ["number", ['get', 'OtherRaceNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5],
                 ["!=", ["/", ["number", ['get', 'MultiRacialNum']],
                              ["+", ["number", ['get', 'CaucasianNum']],
                                    ["number", ['get', 'HispanicNum']],
                                    ["number", ['get', 'OtherRaceNum']],
                                    ["number", ['get', 'MultiRacialNum']],
                                    ["number", ['get', 'AfroAmericanNum']]]],
                 0.5]],
        "#7f7f7f",
        "rgba(255,243,143,0.98)"
            ]);
    }

    while (legend.hasChildNodes()) {
         legend.removeChild(legend.firstChild);
     }

     var layers = ['African American Majority', 'Caucasian Majority',
         'Hispanic Majority', 'Other Race Majority', 'Multiracial Majority', 'No Clear Majority', 'The Rest of D65'];
     var colors = ["#43fc0d", "#0cebfc", "#ca0dfc", "#fc092e", "#f37600", "#7f7f7f", "rgba(255,243,143,0.98)"];

     var label = document.createElement('label');
     label.innerHTML = resultB + ' v. ' + resultA;
     legend.appendChild(label);

     for (i = 0; i < layers.length; i++) {
         var layer = layers[i];
         var color = colors[i];
         var item = document.createElement('div');
         var key = document.createElement('span');
         key.className = 'legend-key';
         key.style.backgroundColor = color;

         var value = document.createElement('span');
         value.innerHTML = layer;
         item.appendChild(key);
         item.appendChild(value);
         legend.appendChild(item);
     }
}


//Slider modification by grades
function compGrades(resultA, resultB) {
    document.getElementById('slider').addEventListener('input', function(input)
    {
        var percent = parseInt(input.target.value, 10);
        modifyGrades(percent, resultA, resultB);
    });
}

function modifyGrades(percent, resultA, resultB) {
    if (percent === 0) {
        map.setPaintProperty("blocks", 'fill-color', ["case",
            ["==", ['number', ['get', 'currentSchool']],
                300],
            "transparent",
            ["all", [">=", ["/", ["number", ['get', 'k-2']],
                ["+", ["number", ['get', 'k-2']],
                    ["number", ['get', '3-5']],
                    ["number", ['get', '6-8']]]],
                0.5],
                ["!=", ['number', ['get', 'currentSchool']],
                    ["number", ['get', 'newSchool_' + methodName + resultA]]]],
            "#fc1515",
            ["all", [">=", ["/", ["number", ['get', '3-5']],
                ["+", ["number", ['get', 'k-2']],
                    ["number", ['get', '3-5']],
                    ["number", ['get', '6-8']]]],
                0.5],
                ["!=", ['number', ['get', 'currentSchool']],
                    ["number", ['get', 'newSchool_' + methodName + resultA]]]],
            "#ffdb06",
            ["all", [">=", ["/", ["number", ['get', '6-8']],
                ["+", ["number", ['get', 'k-2']],
                    ["number", ['get', '3-5']],
                    ["number", ['get', '6-8']]]],
                0.5],
                ["!=", ['number', ['get', 'currentSchool']],
                    ["number", ['get', 'newSchool_' + methodName + resultA]]]],
            "#39ff10",
            ["all", ["!=", ['number', ['get', 'currentSchool']],
                ["number", ['get', 'newSchool_' + methodName + resultA]]],
                ["!=", ["/", ["number", ['get', 'k-2']],
                    ["+", ["number", ['get', 'k-2']],
                        ["number", ['get', '3-5']],
                        ["number", ['get', '6-8']]]],
                    0.5],
                ["!=", ["/", ["number", ['get', '3-5']],
                    ["+", ["number", ['get', 'k-2']],
                        ["number", ['get', '3-5']],
                        ["number", ['get', '6-8']]]],
                    0.5],
                ["!=", ["/", ["number", ['get', '6-8']],
                    ["+", ["number", ['get', 'k-2']],
                        ["number", ['get', '3-5']],
                        ["number", ['get', '6-8']]]],
                    0.5]],
            "#7f7f7f",
            "rgba(46,232,197,0.38)"
        ]);
    }
    if (8.3 * percentages[percent] === 830) {
        map.setPaintProperty("blocks", 'fill-color', ["case",
            ["==", ['number', ['get', 'currentSchool']],
                300],
            "transparent",
            ["all", [">=", ["/", ["number", ['get', 'k-2']],
                ["+", ["number", ['get', 'k-2']],
                    ["number", ['get', '3-5']],
                    ["number", ['get', '6-8']]]],
                0.5],
                ["!=", ['number', ['get', 'currentSchool']],
                    ["number", ['get', 'newSchool_' + methodName + resultB]]]],
            "#fc1515",
            ["all", [">=", ["/", ["number", ['get', '3-5']],
                ["+", ["number", ['get', 'k-2']],
                    ["number", ['get', '3-5']],
                    ["number", ['get', '6-8']]]],
                0.5],
                ["!=", ['number', ['get', 'currentSchool']],
                    ["number", ['get', 'newSchool_' + methodName + resultB]]]],
            "#ffdb06",
            ["all", [">=", ["/", ["number", ['get', '6-8']],
                ["+", ["number", ['get', 'k-2']],
                    ["number", ['get', '3-5']],
                    ["number", ['get', '6-8']]]],
                0.5],
                ["!=", ['number', ['get', 'currentSchool']],
                       ["number", ['get', 'newSchool_' + methodName + resultB]]]],
            "#39ff10",
            ["all", ["!=", ['number', ['get', 'currentSchool']],
                           ["number", ['get', 'newSchool_' + methodName + resultB]]],
                ["!=", ["/", ["number", ['get', 'k-2']],
                    ["+", ["number", ['get', 'k-2']],
                        ["number", ['get', '3-5']],
                        ["number", ['get', '6-8']]]],
                    0.5],
                ["!=", ["/", ["number", ['get', '3-5']],
                    ["+", ["number", ['get', 'k-2']],
                        ["number", ['get', '3-5']],
                        ["number", ['get', '6-8']]]],
                    0.5],
                ["!=", ["/", ["number", ['get', '6-8']],
                    ["+", ["number", ['get', 'k-2']],
                        ["number", ['get', '3-5']],
                        ["number", ['get', '6-8']]]],
                    0.5]],
            "#7f7f7f",
            "rgba(46,232,197,0.38)"
        ]);
    } else {
        map.setPaintProperty("blocks", 'fill-color', ["case",
            ["==", ['number', ['get', 'currentSchool']],
                300],
            "transparent",
            ["all", ['>=', ['number', ['get', 'id']],
                1],
                ['<=', ['number', ['get', 'id']],
                    8.3 * percentages[percent]],
                [">=", ["/", ["number", ['get', 'k-2']],
                    ["+", ["number", ['get', 'k-2']],
                        ["number", ['get', '3-5']],
                        ["number", ['get', '6-8']]]],
                    0.5],
                ["!=", ['number', ['get', 'currentSchool']],
                       ["number", ['get', 'newSchool_' + methodName + resultA]]]],
            "#fc1515",
            ["all", ['>=', ['number', ['get', 'id']],
                1],
                ['<=', ['number', ['get', 'id']],
                    8.3 * percentages[percent]],
                [">=", ["/", ["number", ['get', '3-5']],
                    ["+", ["number", ['get', 'k-2']],
                        ["number", ['get', '3-5']],
                        ["number", ['get', '6-8']]]],
                    0.5],
                ["!=", ['number', ['get', 'currentSchool']],
                       ["number", ['get', 'newSchool_' + methodName + resultA]]]],
            "#ffdb06",
            ["all", ['>=', ['number', ['get', 'id']],
                1],
                ['<=', ['number', ['get', 'id']],
                    8.3 * percentages[percent]],
                [">=", ["/", ["number", ['get', '6-8']],
                    ["+", ["number", ['get', 'k-2']],
                        ["number", ['get', '3-5']],
                        ["number", ['get', '6-8']]]],
                    0.5],
                ["!=", ['number', ['get', 'currentSchool']],
                       ["number", ['get', 'newSchool_' + methodName + resultA]]]],
            "#39ff10",
            ["all", ['>=', ['number', ['get', 'id']],
                1],
                ['<=', ['number', ['get', 'id']],
                    8.3 * percentages[percent]],
                ["!=", ['number', ['get', 'currentSchool']],
                       ["number", ['get', 'newSchool_' + methodName + resultA]]],
                ["!=", ["/", ["number", ['get', 'k-2']],
                    ["+", ["number", ['get', 'k-2']],
                        ["number", ['get', '3-5']],
                        ["number", ['get', '6-8']]]],
                    0.5],
                ["!=", ["/", ["number", ['get', '3-5']],
                    ["+", ["number", ['get', 'k-2']],
                        ["number", ['get', '3-5']],
                        ["number", ['get', '6-8']]]],
                    0.5],
                ["!=", ["/", ["number", ['get', '6-8']],
                    ["+", ["number", ['get', 'k-2']],
                        ["number", ['get', '3-5']],
                        ["number", ['get', '6-8']]]],
                    0.5]],
            "#7f7f7f",
            ["all", ['>=', ['number', ['get', 'id']],
                (8.3 * percentages[percent]) + 1],
                ['<=', ['number', ['get', 'id']],
                    830],
                [">=", ["/", ["number", ['get', 'k-2']],
                    ["+", ["number", ['get', 'k-2']],
                        ["number", ['get', '3-5']],
                        ["number", ['get', '6-8']]]],
                    0.5],
                ["!=", ['number', ['get', 'currentSchool']],
                       ["number", ['get', 'newSchool_' + methodName + resultB]]]],
            "#fc1515",
            ["all", ['>=', ['number', ['get', 'id']],
                (8.3 * percentages[percent]) + 1],
                ['<=', ['number', ['get', 'id']],
                    830],
                [">=", ["/", ["number", ['get', '3-5']],
                    ["+", ["number", ['get', 'k-2']],
                        ["number", ['get', '3-5']],
                        ["number", ['get', '6-8']]]],
                    0.5],
                ["!=", ['number', ['get', 'currentSchool']],
                       ["number", ['get', 'newSchool_' + methodName + resultB]]]],
            "#ffdb06",
            ["all", ['>=', ['number', ['get', 'id']],
                (8.3 * percentages[percent]) + 1],
                ['<=', ['number', ['get', 'id']],
                    830],
                [">=", ["/", ["number", ['get', '6-8']],
                    ["+", ["number", ['get', 'k-2']],
                        ["number", ['get', '3-5']],
                        ["number", ['get', '6-8']]]],
                    0.5],
                ["!=", ['number', ['get', 'currentSchool']],
                       ["number", ['get', 'newSchool_' + methodName + resultB]]]],
            "#39ff10",
            ["all", ['>=', ['number', ['get', 'id']],
                (8.3 * percentages[percent]) + 1],
                ['<=', ['number', ['get', 'id']],
                    830],
                ["!=", ['number', ['get', 'currentSchool']],
                       ["number", ['get', 'newSchool_' + methodName + resultB]]],
                ["!=", ["/", ["number", ['get', 'k-2']],
                    ["+", ["number", ['get', 'k-2']],
                        ["number", ['get', '3-5']],
                        ["number", ['get', '6-8']]]],
                    0.5],
                ["!=", ["/", ["number", ['get', '3-5']],
                    ["+", ["number", ['get', 'k-2']],
                        ["number", ['get', '3-5']],
                        ["number", ['get', '6-8']]]],
                    0.5],
                ["!=", ["/", ["number", ['get', '6-8']],
                    ["+", ["number", ['get', 'k-2']],
                        ["number", ['get', '3-5']],
                        ["number", ['get', '6-8']]]],
                    0.5]],
            "#7f7f7f",
            "rgba(46,232,197,0.38)"
        ]);
    }


    while (legend.hasChildNodes()) {
        legend.removeChild(legend.firstChild);
    }

    var layers = ['K-2 Majority', '3-5 Majority', '6-8 Majority', 'No Clear Majority', 'The Rest of D65'];
    var colors = ["#fc1515", "#ffdb06", "#39ff10", "#7f7f7f", "rgba(46,232,197,0.38)"];

    var label = document.createElement('label');
    label.innerHTML = resultB + ' v. ' + resultA;
    legend.appendChild(label);

    for (i = 0; i < layers.length; i++) {
        var layer = layers[i];
        var color = colors[i];
        var item = document.createElement('div');
        var key = document.createElement('span');
        key.className = 'legend-key';
        key.style.backgroundColor = color;

        var value = document.createElement('span');
        value.innerHTML = layer;
        item.appendChild(key);
        item.appendChild(value);
        legend.appendChild(item);
    }
}


//Slider modification by TWI
function compTWI(resultA, resultB) {
    document.getElementById('slider').addEventListener('input', function(input)
    {
        var percent = parseInt(input.target.value, 10);
        modifyTWI(percent, resultA, resultB);
    });
}

function modifyTWI(percent, resultA, resultB)
{
    if (percent === 0)
    {
        map.setPaintProperty('blocks', 'fill-color', ["case",
            ["==", ['number', ['get', 'currentSchool']],
                   300],
            "transparent",
            ["all", ['!=', ['number', ['get', 'currentSchool']],
                           ['number', ['get', 'newSchool_' + methodName + resultA]]],
                    [">=", ['/', ['number', ['get', 'twiEnglish']],
                         ['+', ['number', ['get', 'twiOther']],
                               ['number', ['get', 'twiEnglish']],
                               ['number', ['get', 'twiSpanish']]]],
                   0.5]],
            "#0809db",
            ["all", ['!=', ['number', ['get', 'currentSchool']],
                           ['number', ['get', 'newSchool_' + methodName + resultA]]],
                    [">=", ['/', ['number', ['get', 'twiOther']],
                         ['+', ['number', ['get', 'twiOther']],
                               ['number', ['get', 'twiEnglish']],
                               ['number', ['get', 'twiSpanish']]]],
                   0.5]],
            "#fa0eaa",
            ["all", ['!=', ['number', ['get', 'currentSchool']],
                           ['number', ['get', 'newSchool_' + methodName + resultA]]],
                    [">=", ['/', ['number', ['get', 'twiSpanish']],
                         ['+', ['number', ['get', 'twiOther']],
                               ['number', ['get', 'twiEnglish']],
                               ['number', ['get', 'twiSpanish']]]],
                   0.5]],
            "#ffe464",
            ["all", ["!=", ['number', ['get', 'currentSchool']],
                           ['number', ['get', 'newSchool_' + methodName + resultA]]],
                    ["!=", ['/', ['number', ['get', 'twiEnglish']],
                         ['+', ['number', ['get', 'twiOther']],
                               ['number', ['get', 'twiEnglish']],
                               ['number', ['get', 'twiSpanish']]]],
                   0.5],
                    ["!=", ['/', ['number', ['get', 'twiOther']],
                         ['+', ['number', ['get', 'twiOther']],
                               ['number', ['get', 'twiEnglish']],
                               ['number', ['get', 'twiSpanish']]]],
                   0.5],
                    ["!=", ['/', ['number', ['get', 'twiSpanish']],
                         ['+', ['number', ['get', 'twiOther']],
                               ['number', ['get', 'twiEnglish']],
                               ['number', ['get', 'twiSpanish']]]],
                   0.5]],
            "#7f7f7f",
            "rgba(49,255,13,0.53)"
        ]);
    }
    if (8.3 * percentages[percent] === 830)
    {
        map.setPaintProperty('blocks', 'fill-color', ["case",
            ["==", ['number', ['get', 'currentSchool']],
                   300],
            "transparent",
            ["all", ['!=', ['number', ['get', 'currentSchool']],
                           ['number', ['get', 'newSchool_' + methodName + resultB]]],
                    [">=", ['/', ['number', ['get', 'twiEnglish']],
                         ['+', ['number', ['get', 'twiOther']],
                               ['number', ['get', 'twiEnglish']],
                               ['number', ['get', 'twiSpanish']]]],
                   0.5]],
            "#0809db",
            ["all", ['!=', ['number', ['get', 'currentSchool']],
                           ['number', ['get', 'newSchool_' + methodName + resultB]]],
                    [">=", ['/', ['number', ['get', 'twiOther']],
                         ['+', ['number', ['get', 'twiOther']],
                               ['number', ['get', 'twiEnglish']],
                               ['number', ['get', 'twiSpanish']]]],
                   0.5]],
            "#fa0eaa",
            ["all", ['!=', ['number', ['get', 'currentSchool']],
                           ['number', ['get', 'newSchool_' + methodName + resultB]]],
                    [">=", ['/', ['number', ['get', 'twiSpanish']],
                         ['+', ['number', ['get', 'twiOther']],
                               ['number', ['get', 'twiEnglish']],
                               ['number', ['get', 'twiSpanish']]]],
                   0.5]],
            "#ffe464",
            ["all", ["!=", ['number', ['get', 'currentSchool']],
                           ['number', ['get', 'newSchool_' + methodName + resultB]]],
                    ["!=", ['/', ['number', ['get', 'twiEnglish']],
                         ['+', ['number', ['get', 'twiOther']],
                               ['number', ['get', 'twiEnglish']],
                               ['number', ['get', 'twiSpanish']]]],
                   0.5],
                    ["!=", ['/', ['number', ['get', 'twiOther']],
                         ['+', ['number', ['get', 'twiOther']],
                               ['number', ['get', 'twiEnglish']],
                               ['number', ['get', 'twiSpanish']]]],
                   0.5],
                    ["!=", ['/', ['number', ['get', 'twiSpanish']],
                         ['+', ['number', ['get', 'twiOther']],
                               ['number', ['get', 'twiEnglish']],
                               ['number', ['get', 'twiSpanish']]]],
                   0.5]],
            "#7f7f7f",
            "rgba(49,255,13,0.53)"
        ]);
    }
    else
    {
        map.setPaintProperty('blocks', 'fill-color', ["case",
            ["==", ['number', ['get', 'currentSchool']],
                   300],
            "transparent",
            ["all", ['>=', ['number', ['get', 'id']],
                           1],
                    ['<=', ['number', ['get', 'id']],
                           8.3 * percentages[percent]],
                    ['!=', ['number', ['get', 'currentSchool']],
                           ['number', ['get', 'newSchool_' + methodName + resultA]]],
                    [">=", ['/', ['number', ['get', 'twiEnglish']],
                         ['+', ['number', ['get', 'twiOther']],
                               ['number', ['get', 'twiEnglish']],
                               ['number', ['get', 'twiSpanish']]]],
                   0.5]],
            "#0809db",
            ["all", ['>=', ['number', ['get', 'id']],
                           1],
                    ['<=', ['number', ['get', 'id']],
                           8.3 * percentages[percent]],
                    ['!=', ['number', ['get', 'currentSchool']],
                           ['number', ['get', 'newSchool_' + methodName + resultA]]],
                    [">=", ['/', ['number', ['get', 'twiOther']],
                         ['+', ['number', ['get', 'twiOther']],
                               ['number', ['get', 'twiEnglish']],
                               ['number', ['get', 'twiSpanish']]]],
                   0.5]],
            "#fa0eaa",
            ["all", ['>=', ['number', ['get', 'id']],
                           1],
                    ['<=', ['number', ['get', 'id']],
                           8.3 * percentages[percent]],
                    ['!=', ['number', ['get', 'currentSchool']],
                           ['number', ['get', 'newSchool_' + methodName + resultA]]],
                    [">=", ['/', ['number', ['get', 'twiSpanish']],
                         ['+', ['number', ['get', 'twiOther']],
                               ['number', ['get', 'twiEnglish']],
                               ['number', ['get', 'twiSpanish']]]],
                   0.5]],
            "#ffe464",
            ["all", ['>=', ['number', ['get', 'id']],
                           1],
                    ['<=', ['number', ['get', 'id']],
                           8.3 * percentages[percent]],
                    ["!=", ['number', ['get', 'currentSchool']],
                           ['number', ['get', 'newSchool_' + methodName + resultA]]],
                    ["!=", ['/', ['number', ['get', 'twiEnglish']],
                         ['+', ['number', ['get', 'twiOther']],
                               ['number', ['get', 'twiEnglish']],
                               ['number', ['get', 'twiSpanish']]]],
                   0.5],
                    ["!=", ['/', ['number', ['get', 'twiOther']],
                         ['+', ['number', ['get', 'twiOther']],
                               ['number', ['get', 'twiEnglish']],
                               ['number', ['get', 'twiSpanish']]]],
                   0.5],
                    ["!=", ['/', ['number', ['get', 'twiSpanish']],
                         ['+', ['number', ['get', 'twiOther']],
                               ['number', ['get', 'twiEnglish']],
                               ['number', ['get', 'twiSpanish']]]],
                   0.5]],
            "#7f7f7f",
            ["all", ['>=', ['number', ['get', 'id']],
                           (8.3 * percentages[percent]) +1],
                    ['<=', ['number', ['get', 'id']],
                           830],
                    ['!=', ['number', ['get', 'currentSchool']],
                           ['number', ['get', 'newSchool_' + methodName + resultB]]],
                    [">=", ['/', ['number', ['get', 'twiEnglish']],
                         ['+', ['number', ['get', 'twiOther']],
                               ['number', ['get', 'twiEnglish']],
                               ['number', ['get', 'twiSpanish']]]],
                   0.5]],
            "#0809db",
            ["all", ['>=', ['number', ['get', 'id']],
                           (8.3 * percentages[percent]) + 1],
                    ['<=', ['number', ['get', 'id']],
                           830],
                    ['!=', ['number', ['get', 'currentSchool']],
                           ['number', ['get', 'newSchool_' + methodName + resultB]]],
                    [">=", ['/', ['number', ['get', 'twiOther']],
                         ['+', ['number', ['get', 'twiOther']],
                               ['number', ['get', 'twiEnglish']],
                               ['number', ['get', 'twiSpanish']]]],
                   0.5]],
            "#fa0eaa",
            ["all", ['>=', ['number', ['get', 'id']],
                           (8.3 * percentages[percent]) + 1],
                    ['<=', ['number', ['get', 'id']],
                           830],
                    ['!=', ['number', ['get', 'currentSchool']],
                           ['number', ['get', 'newSchool_' + methodName + resultA]]],
                    [">=", ['/', ['number', ['get', 'twiSpanish']],
                         ['+', ['number', ['get', 'twiOther']],
                               ['number', ['get', 'twiEnglish']],
                               ['number', ['get', 'twiSpanish']]]],
                   0.5]],
            "#ffe464",
            ["all", ['>=', ['number', ['get', 'id']],
                           (8.3 * percentages[percent]) + 1],
                    ['<=', ['number', ['get', 'id']],
                           830],
                    ["!=", ['number', ['get', 'currentSchool']],
                           ['number', ['get', 'newSchool_' + methodName + resultA]]],
                    ["!=", ['/', ['number', ['get', 'twiEnglish']],
                         ['+', ['number', ['get', 'twiOther']],
                               ['number', ['get', 'twiEnglish']],
                               ['number', ['get', 'twiSpanish']]]],
                   0.5],
                    ["!=", ['/', ['number', ['get', 'twiOther']],
                         ['+', ['number', ['get', 'twiOther']],
                               ['number', ['get', 'twiEnglish']],
                               ['number', ['get', 'twiSpanish']]]],
                   0.5],
                    ["!=", ['/', ['number', ['get', 'twiSpanish']],
                         ['+', ['number', ['get', 'twiOther']],
                               ['number', ['get', 'twiEnglish']],
                               ['number', ['get', 'twiSpanish']]]],
                   0.5]],
            "#7f7f7f",
            "rgba(49,255,13,0.53)"
        ]);
    }

    while (legend.hasChildNodes()) {
         legend.removeChild(legend.firstChild);
     }

     var layers = ['TWI English Majority', 'TWI Other Majority',
         'TWI Spanish Majority', 'No Clear Majority', 'The Rest of D65'];
     var colors = ["#0809db", "#fa0eaa", "#ffe464", "#7f7f7f", "rgba(49,255,13,0.53)"];

     var label = document.createElement('label');
     label.innerHTML = resultB + ' v. ' + resultA;
     legend.appendChild(label);

     for (i = 0; i < layers.length; i++) {
         var layer = layers[i];
         var color = colors[i];
         var item = document.createElement('div');
         var key = document.createElement('span');
         key.className = 'legend-key';
         key.style.backgroundColor = color;

         var value = document.createElement('span');
         value.innerHTML = layer;
         item.appendChild(key);
         item.appendChild(value);
         legend.appendChild(item);
     }

}



</script>

 
